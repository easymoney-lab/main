# 体验版功能无法使用 - 问题排查

## 🔍 常见问题及解决方案

### 问题1：GPS定位功能无法使用

#### 症状
- 点击定位按钮没反应
- 提示权限被拒绝
- 无法获取位置

#### 解决方案

**检查1：权限配置**
确认 `app.json` 中有权限配置：
```json
"permission": {
  "scope.userLocation": {
    "desc": "你的位置信息将用于记录行程地点"
  }
}
```

**检查2：体验者权限设置**
1. 登录微信公众平台
2. 进入：设置 > 基本设置 > 服务类目
3. 确认已添加"位置信息"相关类目

**检查3：体验者手机设置**
- 体验者需要在手机设置中允许小程序获取位置权限
- 路径：手机设置 > 应用管理 > 微信 > 权限 > 位置信息

**临时解决方案：**
如果定位功能有问题，可以暂时手动输入地点，不影响其他功能使用。

### 问题2：数据无法保存

#### 症状
- 添加行程后数据消失
- 刷新后数据丢失

#### 解决方案

**检查1：存储权限**
- 小程序需要本地存储权限
- 检查手机是否允许小程序使用存储

**检查2：存储空间**
- 检查手机存储空间是否充足
- 清除小程序缓存后重试

**检查3：代码问题**
确认 `utils/util.js` 中的存储函数正常：
```javascript
wx.setStorageSync('trips', trips);
```

### 问题3：页面无法打开

#### 症状
- 点击某个页面没反应
- 页面显示空白
- 提示页面不存在

#### 解决方案

**检查1：页面路径**
确认 `app.json` 中页面路径正确：
```json
"pages": [
  "pages/index/index",
  "pages/add/add",
  "pages/detail/detail",
  "pages/settings/settings"
]
```

**检查2：文件完整性**
确认所有页面文件都存在：
- pages/index/index.js, index.wxml, index.wxss
- pages/add/add.js, add.wxml, add.wxss
- pages/detail/detail.js, detail.wxml, detail.wxss
- pages/settings/settings.js, settings.wxml, settings.wxss

**检查3：重新上传**
- 重新上传代码
- 重新设置为体验版

### 问题4：功能按钮无响应

#### 症状
- 点击按钮没反应
- 没有错误提示

#### 解决方案

**检查1：控制台错误**
- 在微信开发者工具中查看控制台
- 查看是否有JavaScript错误

**检查2：事件绑定**
确认事件绑定正确：
```xml
<button bindtap="submitTrip">提交行程</button>
```

**检查3：函数定义**
确认对应的函数已定义：
```javascript
submitTrip() {
  // 函数内容
}
```

### 问题5：样式显示异常

#### 症状
- 页面布局错乱
- 样式不显示
- 颜色不对

#### 解决方案

**检查1：样式文件**
确认所有 `.wxss` 文件都存在

**检查2：样式语法**
确认样式语法正确，没有语法错误

**检查3：清除缓存**
- 在微信中清除小程序缓存
- 重新打开小程序

## 🔧 通用排查步骤

### 步骤1：检查体验版版本

1. 登录微信公众平台
2. 进入：开发 > 版本管理
3. 确认体验版版本是最新的
4. 如果不是，重新上传并设置为体验版

### 步骤2：检查体验者状态

1. 进入：成员管理 > 体验者
2. 确认体验者已添加且状态正常
3. 确认体验者已在微信中确认

### 步骤3：检查小程序基础库版本

1. 在微信公众平台查看基础库版本要求
2. 确认体验者的微信版本支持
3. 建议最低版本：2.11.1（支持组件按需注入）

### 步骤4：查看错误日志

1. 让体验者打开小程序
2. 在微信中：我 > 设置 > 帮助与反馈 > 右上角工具图标
3. 查看错误日志
4. 或使用真机调试查看日志

### 步骤5：重新上传代码

1. 在微信开发者工具中重新上传
2. 版本号递增（如：1.0.0 → 1.0.1）
3. 重新设置为体验版

## 🛠️ 快速修复脚本

创建一个检查脚本来诊断问题：

```bash
# 检查文件完整性
./检查文件完整性.sh

# 检查配置
./检查配置.sh
```

## 📱 体验者操作指南

### 首次使用

1. **扫码打开小程序**
   - 扫描体验版二维码
   - 首次打开会显示授权提示

2. **允许权限**
   - 位置权限：点击"允许"（如果需要定位功能）
   - 存储权限：通常自动允许

3. **测试功能**
   - 先测试添加行程功能
   - 再测试其他功能

### 如果功能不工作

1. **清除缓存**
   - 长按小程序图标
   - 选择"删除"（不会删除数据）
   - 重新扫码打开

2. **检查权限**
   - 手机设置 > 应用管理 > 微信 > 权限
   - 确认位置权限已开启

3. **更新微信**
   - 确保微信是最新版本
   - 旧版本可能不支持某些功能

## 🐛 常见错误代码

### errMsg: "chooseLocation:fail"
- **原因**：位置权限被拒绝
- **解决**：在手机设置中开启位置权限

### errMsg: "getLocation:fail"
- **原因**：GPS信号弱或权限问题
- **解决**：到开阔地带重试，或手动输入地点

### errMsg: "setStorageSync:fail"
- **原因**：存储权限问题或存储空间不足
- **解决**：检查存储空间，清除缓存

## 💡 调试建议

### 开发环境测试
1. 先在开发者工具中测试所有功能
2. 使用预览功能在手机上测试
3. 确认无误后再上传体验版

### 分步测试
1. 先测试基础功能（添加、查看）
2. 再测试高级功能（定位、搜索）
3. 最后测试设置功能

### 收集反馈
- 记录具体哪个功能无法使用
- 记录错误提示信息
- 记录操作步骤

## 🚀 紧急修复流程

如果体验版完全无法使用：

1. **回退到开发版**
   - 在版本管理中选择之前的版本
   - 设置为体验版

2. **修复代码**
   - 在开发者工具中修复问题
   - 测试通过后重新上传

3. **重新发布体验版**
   - 上传新版本
   - 设置为体验版
   - 通知体验者重新扫码

## 📞 获取帮助

如果以上方法都无法解决：

1. **查看微信开发者文档**
   - https://developers.weixin.qq.com/miniprogram/dev/framework/

2. **查看错误日志**
   - 在微信中查看小程序错误日志
   - 或在开发者工具中查看

3. **联系技术支持**
   - 微信公众平台客服
   - 开发者社区

