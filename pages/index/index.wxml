<!--pages/index/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="top-bar">
    <view class="user-switch">
    <view class="switch-item {{userIdentity === 'userA' ? 'active' : ''}}" bindtap="switchUser" data-user="userA">
      {{userNames.userA}}
    </view>
    <view class="switch-item {{userIdentity === 'userB' ? 'active' : ''}}" bindtap="switchUser" data-user="userB">
      {{userNames.userB}}
    </view>
    </view>
    <view class="settings-btn" bindtap="goToSettings">
      <text class="settings-icon">âš™ï¸</text>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view wx:if="{{trips.length > 0}}" class="stats-card">
    <view class="stat-item">
      <text class="stat-label">æ€»è®°å½•</text>
      <text class="stat-value">{{stats.total}}</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-label">{{userNames.userA}}</text>
      <text class="stat-value">{{stats.userA}}</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-label">{{userNames.userB}}</text>
      <text class="stat-value">{{stats.userB}}</text>
    </view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view wx:if="{{trips.length > 0}}" class="search-box">
    <input class="search-input" placeholder="æœç´¢åœ°ç‚¹æˆ–å†…å®¹..." value="{{searchKeyword}}" bindinput="onSearchInput" />
    <text wx:if="{{searchKeyword}}" class="search-clear" bindtap="clearSearch">âœ•</text>
  </view>

  <!-- è¡Œç¨‹åˆ—è¡¨ -->
  <view class="trips-list">
    <!-- ä¿®æ”¹ç©ºçŠ¶æ€åˆ¤æ–­é€»è¾‘ -->
    <view wx:if="{{trips.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“</text>
      <text>è¿˜æ²¡æœ‰è¡Œç¨‹è®°å½•~</text>
      <text class="empty-tip">å¿«å»æ±‡æŠ¥ä½ çš„è¡Œç¨‹å§ï¼</text>
    </view>

    <view wx:elif="{{filteredTrips.length === 0 && trips.length > 0}}" class="empty-state">
      <text class="empty-icon">ğŸ”</text>
      <text>æ²¡æœ‰æ‰¾åˆ°ç›¸å…³è®°å½•</text>
      <text class="empty-tip">è¯•è¯•å…¶ä»–å…³é”®è¯å§~</text>
    </view>
    
    <!-- ä¿®å¤wx:elseè¯­æ³•é”™è¯¯ -->
    <view wx:else>
      <view wx:for="{{filteredTrips}}" wx:key="id" class="trip-card" bindtap="viewDetail" data-id="{{item.id}}">
        <view class="trip-header">
          <view class="user-badge {{item.user === userIdentity ? 'self' : 'other'}}">
            {{item.user === userIdentity ? userNames[userIdentity] : userNames[item.user]}}
          </view>
          <text class="time">{{item.time}}</text>
        </view>
        <view class="trip-location">
          <text class="location-icon">ğŸ“</text>
          <text class="location-text">{{item.location}}</text>
        </view>
        <view wx:if="{{item.content}}" class="trip-content">
          {{item.content}}
        </view>
        <view class="trip-footer">
          <text class="create-time">{{item.createTimeText}}</text>
        </view>
      </view>
    </view>
  </view>
  <!-- è°ƒè¯•æŒ‰é’® -->
  <!-- ç®€å•åˆ·æ–°æŒ‰é’® -->
  <view wx:if="{{true}}" class="debug-btn" bindtap="simpleRefresh" style="background: #4CAF50; margin-top: 20rpx;">
    <text>ğŸ”„ ç®€å•åˆ·æ–°</text>
  </view>
</view>